<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0" />

    <!-- Á§æ‰∫§Â™í‰ΩìÂàÜ‰∫´È¢ÑËßà -->
    <meta property="og:title" content="Â≠êÊù∞ÊöëÂÅáËØæÁ®ãÂÆâÊéí" />
    <meta property="og:description" content="2025Âπ¥ÊöëÂÅáÂ≠¶‰π†ËÆ°ÂàíÔºåËØæÁ®ãÂÆâÊéí‰∏ÄÁõÆ‰∫ÜÁÑ∂ÔºåÊîØÊåÅÂú®Á∫øÁºñËæëÂíåËØæÁ®ãÊèêÈÜí" />
    <meta property="og:image" content="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=1200&h=630&fit=crop&auto=format" />
    <meta property="og:url" content="https://damonxuda.github.io/course-schedule/" />
    <meta property="og:type" content="website" />
    
    <!-- ÂæÆ‰ø°ÂàÜ‰∫´‰ºòÂåñ -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Â≠êÊù∞ÊöëÂÅáËØæÁ®ãÂÆâÊéí" />
    <meta name="twitter:description" content="2025Âπ¥ÊöëÂÅáÂ≠¶‰π†ËÆ°ÂàíÔºåËØæÁ®ãÂÆâÊéí‰∏ÄÁõÆ‰∫ÜÁÑ∂ÔºåÊîØÊåÅÂú®Á∫øÁºñËæëÂíåËØæÁ®ãÊèêÈÜí" />
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=1200&h=630&fit=crop&auto=format" />

    <!-- PWA ÊîØÊåÅ -->
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="ËØæÁ®ãË°®" />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23667eea'/><text x='50' y='60' font-size='50' text-anchor='middle' fill='white'>üìö</text></svg>"
    />
    <link
      rel="manifest"
      href="data:application/json,{
        'name': 'ÊöëÂÅáËØæÁ®ãÊó•ÂéÜ',
        'short_name': 'ËØæÁ®ãË°®',
        'start_url': '.',
        'display': 'standalone',
        'background_color': '#667eea',
        'theme_color': '#667eea',
        'icons': [
            {
                'src': 'data:image/svg+xml,<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 100 100\\'><rect width=\\'100\\' height=\\'100\\' fill=\\'%23667eea\\'/><text x=\\'50\\' y=\\'60\\' font-size=\\'50\\' text-anchor=\\'middle\\' fill=\\'white\\'>üìö</text></svg>',
                'sizes': '192x192',
                'type': 'image/svg+xml'
            }
        ]
    }"
    />
    <title>ÊöëÂÅáËØæÁ®ãÊó•ÂéÜÊèêÈÜí</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Microsoft YaHei", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        touch-action: manipulation;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #ff6b6b, #ffa726);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 1.8rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .current-date {
        font-size: 1.3rem;
        opacity: 0.9;
      }

      .main-content {
        padding: 30px;
      }

      .today-schedule {
        background: #f8f9ff;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        border-left: 5px solid #667eea;
      }

      .schedule-title {
        font-size: 1.5rem;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
      }

      .schedule-title::before {
        content: "üìÖ";
        margin-right: 10px;
        font-size: 1.8rem;
      }

      .course-item {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .course-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .course-time {
        font-weight: bold;
        color: #ff6b6b;
        font-size: 1.1rem;
        margin-bottom: 5px;
      }

      .course-name {
        color: #333;
        font-size: 1rem;
      }

      .course-smk {
        background: #ffe066;
        border-left: 4px solid #ffd700;
      }

      .course-island {
        background: #66e0ff;
        border-left: 4px solid #00bcd4;
      }

      .course-teacher {
        background: #ff9999;
        border-left: 4px solid #f44336;
      }

      .course-english {
        background: #99ff99;
        border-left: 4px solid #4caf50;
      }

      .course-exercise {
        background: #90ee90;
        border-left: 4px solid #32cd32;
      }

      .course-homework {
        background: #ffb6c1;
        border-left: 4px solid #ff69b4;
      }

      .course-art {
        background: #ffb3e6;
        border-left: 4px solid #e91e63;
      }

      .course-other {
        background: #e0e0e0;
        border-left: 4px solid #757575;
      }

      .no-courses {
        text-align: center;
        color: #666;
        font-size: 1.2rem;
        padding: 40px;
      }

      .calendar-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .nav-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        touch-action: manipulation;
        user-select: none;
      }

      .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
      }

      .nav-btn:active {
        transform: translateY(0);
      }

      .date-display {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
      }

      .stat-label {
        color: #666;
        margin-top: 5px;
      }

      .edit-toggle {
        background: linear-gradient(135deg, #ff6b6b, #ffa726);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        margin-top: 20px;
        transition: all 0.3s ease;
        user-select: none;
      }

      .edit-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      }

      /* ËøûÊé•Áä∂ÊÄÅÊåáÁ§∫ */
      .connection-status {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 8px;
        font-size: 0.9rem;
      }

      .status-connected {
        background: #e8f5e8;
        color: #2e7d32;
        border: 1px solid #c8e6c9;
      }

      .status-disconnected {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ffcdd2;
      }

      .status-loading {
        background: #e3f2fd;
        color: #1976d2;
        border: 1px solid #bbdefb;
      }

      /* ÁºñËæëÂô®Ê†∑Âºè */
      .editor-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .editor-panel {
        background: white;
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .editor-title {
        font-size: 1.4rem;
        font-weight: bold;
        color: #333;
      }

      .close-btn {
        background: #f0f0f0;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        cursor: pointer;
        font-size: 1.2rem;
        color: #666;
        transition: all 0.3s ease;
      }

      .close-btn:hover {
        background: #e0e0e0;
        transform: scale(1.1);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
        font-size: 0.9rem;
      }

      .form-input, .form-select, .form-textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
      }

      .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-textarea {
        min-height: 80px;
        resize: vertical;
      }

      .time-inputs {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 10px;
        align-items: center;
      }

      .time-separator {
        text-align: center;
        font-weight: bold;
        color: #666;
      }

      .course-list {
        margin-bottom: 20px;
      }

      .course-item-edit {
        background: #f8f9ff;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 4px solid #667eea;
      }

      .course-info {
        flex-grow: 1;
      }

      .course-time-edit {
        font-weight: bold;
        color: #ff6b6b;
        font-size: 0.9rem;
      }

      .course-name-edit {
        color: #333;
        font-size: 0.95rem;
        margin-top: 2px;
      }

      .course-actions {
        display: flex;
        gap: 8px;
      }

      .btn-small {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s ease;
      }

      .btn-edit {
        background: #667eea;
        color: white;
      }

      .btn-edit:hover {
        background: #5a6fd8;
        transform: translateY(-1px);
      }

      .btn-delete {
        background: #ff6b6b;
        color: white;
      }

      .btn-delete:hover {
        background: #ff5252;
        transform: translateY(-1px);
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 10px;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #f0f0f0;
        color: #333;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        margin-right: 10px;
      }

      .btn-secondary:hover {
        background: #e0e0e0;
        transform: translateY(-1px);
      }

      .editor-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
      }

      .quick-times {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 8px;
        margin-top: 10px;
      }

      .quick-time-btn {
        background: #f8f9ff;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        text-align: center;
      }

      .quick-time-btn:hover {
        border-color: #667eea;
        background: #667eea;
        color: white;
      }

      /* ÁßªÂä®Á´Ø‰ºòÂåñ */
      @media screen and (max-width: 768px) {
        .editor-panel {
          padding: 20px;
          margin: 10px;
        }
        
        .time-inputs {
          grid-template-columns: 1fr;
          gap: 15px;
        }
        
        .time-separator {
          order: -1;
        }
        
        .quick-times {
          grid-template-columns: repeat(2, 1fr);
        }
        
        .course-item-edit {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
        
        .course-actions {
          width: 100%;
          justify-content: flex-end;
        }
      }

      .supabase-notice {
        background: linear-gradient(135deg, #3ecf8e, #40ba93);
        color: white;
        padding: 15px;
        margin: 20px 0;
        border-radius: 8px;
        text-align: center;
        font-size: 0.9rem;
      }

      .config-warning {
        background: #fff3cd;
        color: #856404;
        padding: 15px;
        margin: 20px 0;
        border-radius: 8px;
        border: 1px solid #ffeaa7;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéì Â≠êÊù∞ÊöëÂÅáËØæÁ®ãÂÆâÊéí</h1>
        <div class="current-date" id="currentDate"></div>
      </div>

      <div class="main-content">
        <!-- SupabaseËøûÊé•Áä∂ÊÄÅ -->
        <div class="connection-status status-loading" id="connectionStatus">
          üîÑ Ê≠£Âú®ËøûÊé•SupabaseÊï∞ÊçÆÂ∫ì...
        </div>

        <!-- SupabaseÈÖçÁΩÆÊèêÈÜí -->
        <div class="config-warning" id="configWarning" style="display: none;">
          ‚ö†Ô∏è ÈúÄË¶ÅÈÖçÁΩÆSupabaseÔºöËØ∑ÊåâÁÖß‰∏ãÊñπËØ¥ÊòéËÆæÁΩÆSupabaseÈ°πÁõÆÈÖçÁΩÆ
        </div>

        <div class="calendar-nav">
          <button class="nav-btn" id="prevBtn">‚Üê Ââç‰∏ÄÂ§©</button>
          <div class="date-display" id="displayDate"></div>
          <button class="nav-btn" id="nextBtn">Âêé‰∏ÄÂ§© ‚Üí</button>
        </div>

        <div class="today-schedule">
          <div class="schedule-title">‰ªäÊó•ËØæÁ®ãÂÆâÊéí</div>
          <div id="scheduleContent"></div>
        </div>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalCourses">0</div>
            <div class="stat-label">‰ªäÊó•ËØæÁ®ãÊï∞</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="courseHours">0</div>
            <div class="stat-label">ËØæÁ®ãÂ∞èÊó∂Êï∞</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="categoryCount">0</div>
            <div class="stat-label">ËØæÁ®ãÁ±ªÂûã</div>
          </div>
        </div>

        <button class="edit-toggle" onclick="handleEditClick()">
          ‚úèÔ∏è ÁºñËæëËØæÁ®ãÂÆâÊéí
        </button>

        <div class="supabase-notice">
          üöÄ ‰ΩøÁî®SupabaseÂºÄÊ∫êÊï∞ÊçÆÂ∫ì - ÊâÄÊúâËÆæÂ§áËá™Âä®ÂêåÊ≠•ÔºÅ
        </div>
      </div>
    </div>

    <!-- ÁºñËæëÂô®ÁïåÈù¢ -->
    <div class="editor-overlay" id="editorOverlay">
      <div class="editor-panel">
        <div class="editor-header">
          <div class="editor-title">üìÖ ËØæÁ®ãÂÆâÊéíÁºñËæëÂô®</div>
          <button class="close-btn" onclick="handleCloseEditor()">√ó</button>
        </div>

        <div class="form-group">
          <label class="form-label">üìÖ ÈÄâÊã©Êó•Êúü</label>
          <input type="date" class="form-input" id="editDate" onchange="handleLoadDateCourses()">
        </div>

        <div class="course-list" id="courseList">
          <!-- ÂΩìÂâçÊó•ÊúüÁöÑËØæÁ®ãÂàóË°® -->
        </div>

        <div class="form-group">
          <label class="form-label">‚è∞ ËØæÁ®ãÊó∂Èó¥</label>
          <div class="time-inputs">
            <input type="time" class="form-input" id="startTime" placeholder="ÂºÄÂßãÊó∂Èó¥">
            <div class="time-separator">Ëá≥</div>
            <input type="time" class="form-input" id="endTime" placeholder="ÁªìÊùüÊó∂Èó¥">
          </div>
          <div class="quick-times">
            <button class="quick-time-btn" onclick="handleSetQuickTime('09:00', '11:00')">09:00-11:00</button>
            <button class="quick-time-btn" onclick="handleSetQuickTime('13:00', '15:00')">13:00-15:00</button>
            <button class="quick-time-btn" onclick="handleSetQuickTime('15:30', '17:30')">15:30-17:30</button>
            <button class="quick-time-btn" onclick="handleSetQuickTime('19:00', '21:00')">19:00-21:00</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">üìö ËØæÁ®ãÂêçÁß∞</label>
          <input type="text" class="form-input" id="courseName" placeholder="ËØ∑ËæìÂÖ•ËØæÁ®ãÂêçÁß∞">
        </div>

        <div class="form-group">
          <label class="form-label">üéØ ËØæÁ®ãÁ±ªÂûã</label>
          <select class="form-select" id="courseType">
            <option value="smk">SMKËã±ËØ≠</option>
            <option value="island">Â≤õ‰∏ª‰∫îÁ´û</option>
            <option value="teacher">ÊôÆËÄÅÂ∏àÂà∑È¢ò</option>
            <option value="english">Ëã±ËØ≠YH</option>
            <option value="exercise">‰ΩìËÇ≤ÈîªÁÇº</option>
            <option value="homework">‰Ωú‰∏öÊó∂Èó¥</option>
            <option value="art">Ëâ∫ÊúØËØæÁ®ã</option>
            <option value="other">ÂÖ∂‰ªñ</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">üìù Â§áÊ≥®ËØ¥ÊòéÔºàÂèØÈÄâÔºâ</label>
          <textarea class="form-textarea" id="courseNote" placeholder="Ê∑ªÂä†ËØæÁ®ãÂ§áÊ≥®ÊàñËØ¥Êòé"></textarea>
        </div>

        <button class="btn-primary" onclick="handleSaveCourse()" id="saveBtn">
          ‚ûï Ê∑ªÂä†ËØæÁ®ã
        </button>

        <div class="editor-actions">
          <button class="btn-secondary" onclick="handleCloseEditor()">ÂèñÊ∂à</button>
        </div>
      </div>
    </div>

    <!-- Supabase SDK -->
    <script type="module">
      // SupabaseÈÖçÁΩÆ
      const supabaseConfig = {
        url: "https://exnfrclagndigmdybicg.supabase.co",
        anonKey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4bmZyY2xhZ25kaWdtZHliaWNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyODMzMjUsImV4cCI6MjA2Njg1OTMyNX0.kDPQuEKP6pSAmcbNn2cuUZZDC5fBT_YYdAYAve9qY9w"
      };

      // Ê£ÄÊü•ÊòØÂê¶ÈÖçÁΩÆ‰∫ÜSupabase
      if (!supabaseConfig.url) {
        document.getElementById('configWarning').style.display = 'block';
        document.getElementById('connectionStatus').innerHTML = '‚ùå ÈúÄË¶ÅÈÖçÁΩÆSupabase';
        document.getElementById('connectionStatus').className = 'connection-status status-disconnected';
        
        // ÊòæÁ§∫ÈÖçÁΩÆËØ¥Êòé
        setTimeout(() => {
          alert('SupabaseÈÖçÁΩÆÊ≠•È™§Ôºö\n\n1. ËÆøÈóÆ https://supabase.com\n2. ÂàõÂª∫Êñ∞È°πÁõÆ\n3. Âú®Settings > API‰∏≠ÊâæÂà∞ÈÖçÁΩÆ‰ø°ÊÅØ\n4. Â§çÂà∂URLÂíåanon keyÂà∞‰ª£Á†Å‰∏≠\n5. Âú®Table Editor‰∏≠ÂàõÂª∫schedulesË°®\n\nËØ¶ÁªÜÊ≠•È™§ÊàëÈ©¨‰∏äÂëäËØâ‰Ω†ÔºÅ');
        }, 2000);
        
        // ÊöÇÊó∂‰ΩøÁî®localStorage‰Ωú‰∏∫Â§áÁî®
        window.useSupabase = false;
      } else {
        window.useSupabase = true;
        
        // ÂàùÂßãÂåñSupabase
        import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm').then(({ createClient }) => {
          const supabase = createClient(supabaseConfig.url, supabaseConfig.anonKey);
          window.supabase = supabase;
          
          document.getElementById('connectionStatus').innerHTML = '‚úÖ Â∑≤ËøûÊé•SupabaseÊï∞ÊçÆÂ∫ì';
          document.getElementById('connectionStatus').className = 'connection-status status-connected';
          
          // ÂàùÂßãÂåñÂ∫îÁî®
          initApp();
        }).catch(error => {
          console.error('SupabaseÂàùÂßãÂåñÂ§±Ë¥•:', error);
          document.getElementById('connectionStatus').innerHTML = '‚ùå SupabaseËøûÊé•Â§±Ë¥•';
          document.getElementById('connectionStatus').className = 'connection-status status-disconnected';
          window.useSupabase = false;
          initApp();
        });
      }
    </script>

    <script>
      // ÈªòËÆ§ËØæÁ®ãÊï∞ÊçÆÔºàSupabaseÊú™ÈÖçÁΩÆÊó∂ÁöÑÂ§á‰ªΩÊï∞ÊçÆÔºâ
      const defaultSchedules = {
        "2025-06-30": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-01": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-02": [],
        "2025-07-03": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-04": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-05": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-06": [],
        "2025-07-07": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-08": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-09": [],
        "2025-07-10": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-11": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-12": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-13": [],
        "2025-07-14": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-15": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-16": [],
        "2025-07-17": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-18": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-19": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-20": [],
        "2025-07-21": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-22": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-23": [],
        "2025-07-24": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-25": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-26": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-27": [],
        "2025-07-28": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-29": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-07-30": [],
        "2025-07-31": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-01": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-02": [
          { time: "12:30-15:00", course: "Â≤õ‰∏ª‰∫îÁ´û", type: "island", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-03": [],
        "2025-08-04": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-05": [
          { time: "9:00-11:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-06": [
          { time: "9:00-11:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-07": [
          { time: "9:00-11:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-08": [
          { time: "9:00-11:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-09": [
          { time: "9:00-11:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-10": [
          { time: "9:00-11:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-11": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-12": [],
        "2025-08-13": [
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-14": [],
        "2025-08-15": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-16": [],
        "2025-08-17": [],
        "2025-08-18": [
          { time: "13:00-15:00", course: "Ëã±ËØ≠SMK", type: "smk", category: "Â≠¶ÁßëËæÖÂØº" },
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-19": [],
        "2025-08-20": [
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-21": [],
        "2025-08-22": [
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-23": [
          { time: "19:00-21:00", course: "ÊôÆËÄÅÂ∏àÂà∑È¢òA", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-24": [
          { time: "19:00-21:00", course: "ÂÆö‰ΩçËÄÉ", type: "teacher", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-25": [
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-26": [],
        "2025-08-27": [
          { time: "15:30-17:30", course: "Ëã±ËØ≠YH", type: "english", category: "Â≠¶ÁßëËæÖÂØº" }
        ],
        "2025-08-28": [],
        "2025-08-29": [],
        "2025-08-30": [],
        "2025-08-31": []
      };

      // Êï∞ÊçÆÁÆ°ÁêÜÊ®°Âùó
      window.ScheduleData = {
        schedules: {},
        
        // ÂàùÂßãÂåñÊï∞ÊçÆ
        async init() {
          if (window.useSupabase && window.supabase) {
            await this.initSupabaseTable();
            await this.loadFromSupabase();
            this.setupSupabaseListeners();
          } else {
            this.loadFromLocal();
          }
        },

        // ÂàùÂßãÂåñSupabaseË°®ÁªìÊûÑ
        async initSupabaseTable() {
          try {
            // Ê£ÄÊü•Ë°®ÊòØÂê¶Â≠òÂú®ÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®‰ºöÂàõÂª∫
            const { data, error } = await window.supabase
              .from('schedules')
              .select('*')
              .limit(1);
              
            if (error && error.code === 'PGRST116') {
              // Ë°®‰∏çÂ≠òÂú®ÔºåÈúÄË¶ÅÁî®Êà∑ÊâãÂä®ÂàõÂª∫
              console.log('ÈúÄË¶ÅÂàõÂª∫schedulesË°®');
            }
          } catch (error) {
            console.error('Ê£ÄÊü•Ë°®ÁªìÊûÑÂ§±Ë¥•:', error);
          }
        },

        // ‰ªéSupabaseÂä†ËΩΩÊï∞ÊçÆ
        async loadFromSupabase() {
          try {
            this.schedules = { ...defaultSchedules };
            
            const { data, error } = await window.supabase
              .from('schedules')
              .select('*');
              
            if (error) {
              console.error('‰ªéSupabaseÂä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
              this.loadFromLocal();
              return;
            }

            // ÂêàÂπ∂SupabaseÊï∞ÊçÆ
            if (data && data.length > 0) {
              data.forEach(row => {
                if (row.date && row.courses) {
                  this.schedules[row.date] = row.courses;
                }
              });
            } else {
              // Â¶ÇÊûúSupabase‰∏≠Ê≤°ÊúâÊï∞ÊçÆÔºå‰øùÂ≠òÈªòËÆ§Êï∞ÊçÆ
              await this.saveDefaultDataToSupabase();
            }
          } catch (error) {
            console.error('Âä†ËΩΩSupabaseÊï∞ÊçÆÂºÇÂ∏∏:', error);
            this.loadFromLocal();
          }
        },

        // ‰øùÂ≠òÈªòËÆ§Êï∞ÊçÆÂà∞Supabase
        async saveDefaultDataToSupabase() {
          try {
            const promises = Object.keys(defaultSchedules).map(date => {
              return window.supabase
                .from('schedules')
                .upsert({
                  date: date,
                  courses: defaultSchedules[date],
                  updated_at: new Date().toISOString()
                });
            });
            
            await Promise.all(promises);
            console.log('ÈªòËÆ§Êï∞ÊçÆÂ∑≤‰øùÂ≠òÂà∞Supabase');
          } catch (error) {
            console.error('‰øùÂ≠òÈªòËÆ§Êï∞ÊçÆÂ§±Ë¥•:', error);
          }
        },

        // ‰øùÂ≠òÂà∞Supabase
        async saveToSupabase(dateStr) {
          if (!window.useSupabase || !window.supabase) return;
          
          try {
            const { error } = await window.supabase
              .from('schedules')
              .upsert({
                date: dateStr,
                courses: this.schedules[dateStr] || [],
                updated_at: new Date().toISOString()
              });
              
            if (error) {
              console.error('‰øùÂ≠òÂà∞SupabaseÂ§±Ë¥•:', error);
            }
          } catch (error) {
            console.error('Supabase‰øùÂ≠òÂºÇÂ∏∏:', error);
          }
        },

        // ËÆæÁΩÆSupabaseÂÆûÊó∂ÁõëÂê¨
        setupSupabaseListeners() {
          if (!window.useSupabase || !window.supabase) return;
          
          try {
            const subscription = window.supabase
              .channel('schedule-changes')
              .on('postgres_changes', {
                event: '*',
                schema: 'public',
                table: 'schedules'
              }, (payload) => {
                console.log('ÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞:', payload);
                if (payload.new && payload.new.date) {
                  this.schedules[payload.new.date] = payload.new.courses || [];
                  if (typeof updateDisplay === 'function') {
                    updateDisplay();
                  }
                }
              })
              .subscribe();

            console.log('SupabaseÂÆûÊó∂ÁõëÂê¨Â∑≤ÂêØÂä®');
          } catch (error) {
            console.error('ËÆæÁΩÆÂÆûÊó∂ÁõëÂê¨Â§±Ë¥•:', error);
          }
        },

        // ‰ªélocalStorageÂä†ËΩΩÔºàÂ§áÁî®ÊñπÊ°àÔºâ
        loadFromLocal() {
          try {
            const saved = localStorage.getItem('scheduleData_supabase_backup');
            if (saved) {
              const parsed = JSON.parse(saved);
              this.schedules = { ...defaultSchedules, ...parsed };
            } else {
              this.schedules = { ...defaultSchedules };
            }
          } catch (error) {
            console.error('‰ªélocalStorageÂä†ËΩΩÂ§±Ë¥•:', error);
            this.schedules = { ...defaultSchedules };
          }
        },

        // ‰øùÂ≠òÂà∞localStorageÔºàÂ§áÁî®ÊñπÊ°àÔºâ
        saveToLocal() {
          try {
            localStorage.setItem('scheduleData_supabase_backup', JSON.stringify(this.schedules));
          } catch (error) {
            console.error('‰øùÂ≠òÂà∞localStorageÂ§±Ë¥•:', error);
          }
        },

        // Ëé∑ÂèñÊåáÂÆöÊó•ÊúüÁöÑËØæÁ®ã
        getScheduleByDate(dateStr) {
          return this.schedules[dateStr] || [];
        },

        // Ê∑ªÂä†ËØæÁ®ã
        async addCourse(dateStr, courseData) {
          if (!this.schedules[dateStr]) {
            this.schedules[dateStr] = [];
          }
          
          courseData.id = Date.now() + Math.random();
          this.schedules[dateStr].push(courseData);
          
          if (window.useSupabase) {
            await this.saveToSupabase(dateStr);
          } else {
            this.saveToLocal();
          }
          
          return courseData.id;
        },

        // Êõ¥Êñ∞ËØæÁ®ã
        async updateCourse(dateStr, courseId, newData) {
          if (!this.schedules[dateStr]) return false;
          
          const courseIndex = this.schedules[dateStr].findIndex(c => c.id == courseId);
          if (courseIndex !== -1) {
            newData.id = courseId;
            this.schedules[dateStr][courseIndex] = newData;
            
            if (window.useSupabase) {
              await this.saveToSupabase(dateStr);
            } else {
              this.saveToLocal();
            }
            return true;
          }
          return false;
        },

        // Âà†Èô§ËØæÁ®ã
        async deleteCourse(dateStr, courseId) {
          if (!this.schedules[dateStr]) return false;
          
          const courseIndex = this.schedules[dateStr].findIndex(c => c.id == courseId);
          if (courseIndex !== -1) {
            this.schedules[dateStr].splice(courseIndex, 1);
            
            if (window.useSupabase) {
              await this.saveToSupabase(dateStr);
            } else {
              this.saveToLocal();
            }
            return true;
          }
          return false;
        }
      };

      // ÁºñËæëÂô®Ê®°Âùó
      window.ScheduleEditor = {
        currentEditingId: null,
        currentEditingDate: null,

        openEditor(date) {
          const today = new Date();
          const year = today.getFullYear();
          const month = today.getMonth() + 1;
          const day = today.getDate();
          const dateStr = date || `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
          
          document.getElementById('editDate').value = dateStr;
          document.getElementById('editorOverlay').style.display = 'flex';
          
          this.loadDateCourses();
          this.clearForm();
        },

        closeEditor() {
          document.getElementById('editorOverlay').style.display = 'none';
          this.clearForm();
          this.currentEditingId = null;
          this.currentEditingDate = null;
        },

        loadDateCourses() {
          const dateStr = document.getElementById('editDate').value;
          if (!dateStr) return;

          const courses = window.ScheduleData.getScheduleByDate(dateStr);
          let courseListHtml = '';

          if (courses.length === 0) {
            courseListHtml = '<div style="text-align: center; color: #666; padding: 20px;">üìÖ ÂΩìÂâçÊó•ÊúüÊ≤°ÊúâÂÆâÊéíËØæÁ®ã</div>';
          } else {
            courses.forEach(course => {
              courseListHtml += 
                `<div class="course-item-edit">
                  <div class="course-info">
                    <div class="course-time-edit">${course.time}</div>
                    <div class="course-name-edit">${course.course}</div>
                  </div>
                  <div class="course-actions">
                    <button class="btn-small btn-edit" onclick="handleEditCourse('${course.id}', '${dateStr}')">ÁºñËæë</button>
                    <button class="btn-small btn-delete" onclick="handleDeleteCourse('${course.id}', '${dateStr}')">Âà†Èô§</button>
                  </div>
                </div>`;
            });
          }

          document.getElementById('courseList').innerHTML = courseListHtml;
        },

        setQuickTime(startTime, endTime) {
          document.getElementById('startTime').value = startTime;
          document.getElementById('endTime').value = endTime;
        },

        clearForm() {
          document.getElementById('startTime').value = '';
          document.getElementById('endTime').value = '';
          document.getElementById('courseName').value = '';
          document.getElementById('courseType').value = 'smk';
          document.getElementById('courseNote').value = '';
          document.getElementById('saveBtn').innerHTML = '‚ûï Ê∑ªÂä†ËØæÁ®ã';
          this.currentEditingId = null;
        },

        editCourse(courseId, dateStr) {
          const courses = window.ScheduleData.getScheduleByDate(dateStr);
          const course = courses.find(c => c.id == courseId);
          
          if (!course) return;

          const timeMatch = course.time.match(/(\d+):(\d+)-(\d+):(\d+)/);
          if (timeMatch) {
            document.getElementById('startTime').value = `${timeMatch[1]}:${timeMatch[2]}`;
            document.getElementById('endTime').value = `${timeMatch[3]}:${timeMatch[4]}`;
          }

          document.getElementById('courseName').value = course.course;
          document.getElementById('courseType').value = course.type;
          document.getElementById('courseNote').value = course.note || '';
          document.getElementById('saveBtn').innerHTML = '‚úÖ Êõ¥Êñ∞ËØæÁ®ã';

          this.currentEditingId = courseId;
          this.currentEditingDate = dateStr;
        },

        async deleteCourse(courseId, dateStr) {
          if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÈó®ËØæÁ®ãÂêóÔºü')) {
            await window.ScheduleData.deleteCourse(dateStr, courseId);
            this.loadDateCourses();
            
            if (typeof updateDisplay === 'function') {
              updateDisplay();
            }
          }
        },

        async saveCourse() {
          const dateStr = document.getElementById('editDate').value;
          const startTime = document.getElementById('startTime').value;
          const endTime = document.getElementById('endTime').value;
          const courseName = document.getElementById('courseName').value.trim();
          const courseType = document.getElementById('courseType').value;
          const courseNote = document.getElementById('courseNote').value.trim();

          if (!dateStr || !startTime || !endTime || !courseName) {
            alert('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑËØæÁ®ã‰ø°ÊÅØÔºàÊó•Êúü„ÄÅÊó∂Èó¥„ÄÅËØæÁ®ãÂêçÁß∞‰∏∫ÂøÖÂ°´È°πÔºâ');
            return;
          }

          if (startTime >= endTime) {
            alert('ÁªìÊùüÊó∂Èó¥ÂøÖÈ°ªÊôö‰∫éÂºÄÂßãÊó∂Èó¥');
            return;
          }

          const courseData = {
            time: `${startTime}-${endTime}`,
            course: courseName,
            type: courseType,
            category: "Â≠¶ÁßëËæÖÂØº",
            note: courseNote
          };

          try {
            if (this.currentEditingId) {
              await window.ScheduleData.updateCourse(this.currentEditingDate, this.currentEditingId, courseData);
              alert('ËØæÁ®ãÊõ¥Êñ∞ÊàêÂäüÔºÅ');
            } else {
              await window.ScheduleData.addCourse(dateStr, courseData);
              alert('ËØæÁ®ãÊ∑ªÂä†ÊàêÂäüÔºÅ');
            }

            this.loadDateCourses();
            this.clearForm();

            if (typeof updateDisplay === 'function') {
              updateDisplay();
            }
          } catch (error) {
            console.error('‰øùÂ≠òËØæÁ®ãÂ§±Ë¥•:', error);
            alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        }
      };

      // ‰∏ªÂ∫îÁî®‰ª£Á†Å
      let currentDate = new Date();

      function formatDate(date) {
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        return `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      }

      function formatDisplayDate(date) {
        const weekdays = ["Âë®Êó•", "Âë®‰∏Ä", "Âë®‰∫å", "Âë®‰∏â", "Âë®Âõõ", "Âë®‰∫î", "Âë®ÂÖ≠"];
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        const weekday = weekdays[date.getDay()];
        return `${year}Âπ¥${month}Êúà${day}Êó• ${weekday}`;
      }

      function updateDisplay() {
        const dateStr = formatDate(currentDate);
        const displayStr = formatDisplayDate(currentDate);
        const todayStr = formatDisplayDate(new Date());

        document.getElementById("currentDate").innerHTML = todayStr;
        document.getElementById("displayDate").innerHTML = displayStr;

        const courses = window.ScheduleData.getScheduleByDate(dateStr);
        const scheduleContent = document.getElementById("scheduleContent");

        if (courses.length === 0) {
          scheduleContent.innerHTML = '<div class="no-courses">üéâ ‰ªäÂ§©Ê≤°ÊúâÂÆâÊéíËØæÁ®ãÔºåÂèØ‰ª•Â•ΩÂ•Ω‰ºëÊÅØÂì¶ÔºÅ</div>';
        } else {
          let html = "";
          courses.forEach(course => {
            html += `<div class="course-item course-${course.type}">
                      <div class="course-time">${course.time}</div>
                      <div class="course-name">${course.course}</div>
                    </div>`;
          });
          scheduleContent.innerHTML = html;
        }

        updateStats(courses);
      }

      function updateStats(courses) {
        document.getElementById("totalCourses").innerHTML = courses.length;

        let totalHours = 0;
        courses.forEach(course => {
          const timeMatch = course.time.match(/(\d+):(\d+)-(\d+):(\d+)/);
          if (timeMatch) {
            const startHour = parseInt(timeMatch[1]);
            const startMin = parseInt(timeMatch[2]);
            const endHour = parseInt(timeMatch[3]);
            const endMin = parseInt(timeMatch[4]);
            const hours = (endHour * 60 + endMin - startHour * 60 - startMin) / 60;
            totalHours += hours;
          }
        });
        
        document.getElementById("courseHours").innerHTML = totalHours.toFixed(1);

        const categories = [...new Set(courses.map(c => c.category || "Â≠¶ÁßëËæÖÂØº"))];
        document.getElementById("categoryCount").innerHTML = categories.length;
      }

      function changeDate(days) {
        currentDate.setDate(currentDate.getDate() + days);
        updateDisplay();
      }

      function bindEvents() {
        document.getElementById('prevBtn')?.addEventListener('click', () => changeDate(-1));
        document.getElementById('nextBtn')?.addEventListener('click', () => changeDate(1));
      }

      // ÂÖ®Â±ÄÂáΩÊï∞
      function handleEditClick() {
        window.ScheduleEditor?.openEditor();
      }

      function handleCloseEditor() {
        window.ScheduleEditor?.closeEditor();
      }

      function handleLoadDateCourses() {
        window.ScheduleEditor?.loadDateCourses();
      }

      function handleSetQuickTime(start, end) {
        window.ScheduleEditor?.setQuickTime(start, end);
      }

      function handleEditCourse(courseId, dateStr) {
        window.ScheduleEditor?.editCourse(courseId, dateStr);
      }

      function handleDeleteCourse(courseId, dateStr) {
        window.ScheduleEditor?.deleteCourse(courseId, dateStr);
      }

      function handleSaveCourse() {
        window.ScheduleEditor?.saveCourse();
      }

      // ÂàùÂßãÂåñÂ∫îÁî®
      async function initApp() {
        // ‰∏∫Áé∞ÊúâËØæÁ®ãÊ∑ªÂä†ID
        Object.keys(defaultSchedules).forEach(date => {
          defaultSchedules[date].forEach((course, index) => {
            if (!course.id) {
              course.id = Date.now() + Math.random() + index;
            }
          });
        });

        await window.ScheduleData.init();
        updateDisplay();
        bindEvents();
      }

      // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          if (!window.useSupabase) {
            initApp();
          }
        });
      } else {
        if (!window.useSupabase) {
          initApp();
        }
      }
    </script>
  </body>
</html>
